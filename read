# DNS Prometheus Exporter

This project provides a **Prometheus exporter** for monitoring BIND DNS, Chrony/NTP, system resources, and network interface metrics.  
It collects statistics via BINDâ€™s XML statistics channel, system utilities, and log parsing, then exposes them on a dedicated HTTP endpoint for Prometheus to scrape.

---

## ğŸ“¦ Requirements

Install dependencies using **APT**:

```bash
sudo apt update
sudo apt install -y python3 python3-pip python3-psutil dnsutils ifstat chrony
```

Then install Python libraries:

```bash
pip3 install prometheus_client requests dnspython
```

---

## ğŸ“‚ Repository

Project GitLab repository:  
ğŸ‘‰ [DNS Prometheus Exporter](https://gitlab.amer.epiqcorp.com/unix-tteam/dns-prometheus-exporter.git)

---

## ğŸš€ Deployment

The exporter includes a `deploy.sh` script to simplify installation and deployment.

To deploy:

```bash
./deploy.sh
```

This will:
- Install necessary dependencies
- Place the exporter in `/usr/local/bin`
- Configure systemd service unit
- Start the exporter service

---

## ğŸ“Š Metrics

The exporter exposes metrics on port **9119** (`http://<server>:9119/metrics`).

### Categories

- **BIND Metrics**
  - `bind_up` â€“ BIND service availability (1 = up, 0 = down)
  - `bind_latency_seconds` â€“ DNS query latency
  - `bind_record_accuracy` â€“ Percentage of expected DNS record matches
  - `bind_query_failures_total` â€“ Total failed queries (timeouts, NXDOMAIN, etc.)
  - `bind_security_failures_total` â€“ Total DNSSEC/security validation failures
  - `bind_truncated_percent` â€“ Percent of truncated DNS responses
  - `bind_truncated_total` â€“ Total truncated DNS responses (from BIND stats)
  - `bind_cache_hit_ratio` â€“ Cache hit/miss ratio
  - `bind_queries_by_type_total{qtype}` â€“ Queries by type
  - `bind_responses_by_rcode_total{rcode}` â€“ Responses by return code
  - `bind_queries_udp_total` / `bind_queries_tcp_total` â€“ Total queries over UDP/TCP
  - `bind_axfr_success_total{zone}` / `bind_axfr_failure_total{zone}` â€“ Zone transfer results
  - `bind_soa_refresh_seconds{zone}` / `bind_soa_expiry_seconds{zone}` â€“ Zone timers
  - `bind_zone_count` â€“ Number of configured DNS zones
  - `bind_recursive_queries_total` / `bind_authoritative_queries_total` â€“ Query mode breakdown
  - `bind_uptime_seconds` â€“ Uptime of the BIND service

- **SERVFAIL Metrics**
  - `bind_servfail_total` â€“ Count of SERVFAILs from logs
  - `bind_servfail_last_timestamp` â€“ Timestamp of the last SERVFAIL

- **System Metrics**
  - `system_cpu_utilization_percent` â€“ CPU usage
  - `system_memory_utilization_percent` â€“ Memory usage
  - `system_swap_utilization_percent` â€“ Swap usage
  - `system_disk_utilization_percent{mountpoint}` â€“ Disk utilization per mount
  - `frr_status` â€“ FRR daemon status (1 = running, 0 = stopped)
  - `chronyd_status` â€“ Chronyd status
  - `chronyd_time_drift_seconds` â€“ Time drift reported by Chrony
  - `chronyd_stratum` â€“ NTP stratum (lower = closer to reference clock)

- **Network Metrics**
  - `system_nic_rx_kbytes_per_sec` â€“ NIC RX throughput
  - `system_nic_tx_kbytes_per_sec` â€“ NIC TX throughput

---

## ğŸ“ˆ Example Prometheus Queries

- **Truncated responses per hour**

```promql
increase(bind_truncated_total[1h])
```

- **Chrony stratum in human-readable form**

```promql
chronyd_stratum
```

(Interpretation: 1 = directly synced to reference clock, 2 = one hop away, etc.)

---

## ğŸ› ï¸ Development & Debugging

Run the exporter manually:

```bash
python3 dns_exporter.py
```

Logs will show updates for each metric collection cycle.

---

## ğŸ“‘ License

Internal use only â€“ Epiq Corp Unix Team.
